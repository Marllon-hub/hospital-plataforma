{% extends "base.html" %}
{% block title %}Escalas{% endblock %}

{% block content %}

<h1>üìÖ Escalas</h1>

<div class="card" style="margin-bottom:20px;">
  <h3>Gerar escala do m√™s</h3>

  <form method="post"
        action="{{ url_for('admin_escalas_gerar') }}"
        style="display:flex; gap:15px; flex-wrap:wrap; align-items:end;">

    <div>
      <label>Ano</label><br>
      <input type="number"
             name="ano"
             value="{{ default_ano or 2026 }}"
             required
             style="width:120px;">
    </div>

    <div>
      <label>M√™s</label><br>
      <input type="number"
             name="mes"
             min="1"
             max="12"
             value="{{ default_mes or '' }}"
             required
             style="width:120px;">
    </div>

    <div>
      <label>Setor (opcional)</label><br>
      <select name="setor" style="width:320px;">
        <option value="">Todos</option>

        <option value="ADM(ARQUIVO)">ADM(ARQUIVO)</option>
        <option value="ADM(ULTRASSON)">ADM(ULTRASSON)</option>
        <option value="ADM(CONTAS M√âDICAS)">ADM(CONTAS M√âDICAS)</option>
        <option value="ADM(DIRE√á√ÉO ADMINISTRATIVA)">ADM(DIRE√á√ÉO ADMINISTRATIVA)</option>
        <option value="ADM(DIRE√á√ÉO M√âDICA)">ADM(DIRE√á√ÉO M√âDICA)</option>
        <option value="ADM(FARM√ÅCIA)">ADM(FARM√ÅCIA)</option>
        <option value="ROUP√ÅRIA">ROUP√ÅRIA</option>
        <option value="SERVI√áO SOCIAL">SERVI√áO SOCIAL</option>
        <option value="PSICOLOGIA">PSICOLOGIA</option>
        <option value="NUTRI√á√ÉO">NUTRI√á√ÉO</option>
        <option value="COSTURA">COSTURA</option>
        <option value="RECEP√á√ÉO">RECEP√á√ÉO</option>
        <option value="ASG">ASG</option>
        <option value="MAQUEIRO">MAQUEIRO</option>
        <option value="DIRETORA M√âDICA">DIRETORA M√âDICA</option>
        <option value="DIRETORA ADM">DIRETORA ADM</option>
        <option value="M√âDICO(ANESTESISTA)">M√âDICO(ANESTESISTA)</option>
        <option value="M√âDICO(GINEC√ì)">M√âDICO(GINEC√ì)</option>
        <option value="M√âDICO(NEONATOLOGIA E SALA DE PARTO)">M√âDICO(NEONATOLOGIA E SALA DE PARTO)</option>
        <option value="M√âDICO(OBSTETR√çCIA)">M√âDICO(OBSTETR√çCIA)</option>
        <option value="M√âDICO(PEDIATRIA)">M√âDICO(PEDIATRIA)</option>
        <option value="M√âDICO(USG)">M√âDICO(USG)</option>
        <option value="M√âDICO(VISITADOR OBSTETR√çCIA)">M√âDICO(VISITADOR OBSTETR√çCIA)</option>
        <option value="M√âDICO(NEP)">M√âDICO(NEP)</option>
        <option value="M√âDICO(CIRURGIA PEDI√ÅTRICA)">M√âDICO(CIRURGIA PEDI√ÅTRICA)</option>
      </select>
    </div>

    <div>
      <button class="btn" type="submit">‚öôÔ∏è Gerar</button>
    </div>

  </form>

  <p style="color:#666; margin-top:12px;">
    Regras: Plantonista 24x96 (baseado no <strong>plantao_base</strong>) e demais Seg‚ÄìSex (s√°b/dom folga).
  </p>
</div>

<div class="card">
  <h3>Escalas j√° criadas</h3>

  {% if escalas %}
    <table class="table">
      <tr>
        <th>M√™s</th>
        <th>Setor</th>
        <th>Criado em</th>
        <th>A√ß√£o</th>
      </tr>

      {% for e in escalas %}
      <tr>
        <td>{{ "%02d"|format(e.mes) }}/{{ e.ano }}</td>
        <td>{{ e.setor or "Todos" }}</td>
        <td>{{ e.criado_em.strftime("%d/%m/%Y %H:%M") if e.criado_em else "-" }}</td>

        <td style="display:flex; gap:10px; align-items:center;">
          <a href="{{ url_for('admin_escala_mes', escala_mes_id=e.id) }}">
            üîé Abrir
          </a>

          <form method="post"
                action="{{ url_for('admin_excluir_escala', escala_mes_id=e.id) }}"
                onsubmit="return confirm('Deseja excluir a escala {{ '%02d'|format(e.mes) }}/{{ e.ano }}?');"
                style="margin:0;">
            <button type="submit"
                    style="background:#d9534f;
                           color:white;
                           border:0;
                           padding:6px 10px;
                           border-radius:6px;
                           cursor:pointer;">
              üóë Excluir
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>Nenhuma escala criada ainda.</p>
  {% endif %}
</div>

{% endblock %}
