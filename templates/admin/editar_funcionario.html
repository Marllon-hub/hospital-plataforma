{% extends "base.html" %}
{% block title %}Editar Funcion√°rio{% endblock %}

{% block content %}

<h2>Editar Funcion√°rio</h2>

<div class="card" style="max-width:700px;">

<form method="POST" class="form-grid">

    <label>Nome</label>
    <input type="text" name="nome" value="{{ funcionario.nome }}" required>

    <label>CPF</label>
    <input type="text" name="cpf" value="{{ funcionario.cpf }}" required>

    <label>Fun√ß√£o</label>
    <input type="text" name="funcao" value="{{ funcionario.funcao }}" required>

    <label>Setor (Padr√£o)</label>
    {% set opcoes_setor = [
        "ADM(ARQUIVO)",
        "ADM(ULTRASSON)",
        "ADM(CONTAS M√âDICAS)",
        "ADM(DIRE√á√ÉO ADMINISTRATIVA)",
        "ADM(DIRE√á√ÉO M√âDICA)",
        "ADM(FARM√ÅCIA)",
        "ROUP√ÅRIA",
        "SERVI√áO SOCIAL",
        "PSICOLOGIA",
        "NUTRI√á√ÉO",
        "COSTURA",
        "RECEP√á√ÉO",
        "ASG",
        "MAQUEIRO",
        "DIRETORA M√âDICA",
        "DIRETORA ADM",
        "M√âDICO(ANESTESISTA)",
        "M√âDICO(GINEC√ì)",
        "M√âDICO(NEONATOLOGIA E SALA DE PARTO)",
        "M√âDICO(OBSTETR√çCIA)",
        "M√âDICO(PEDIATRIA)",
        "M√âDICO(USG)",
        "M√âDICO(VISITADOR OBSTETR√çCIA)",
        "M√âDICO(NEP)",
        "M√âDICO(CIRURGIA PEDI√ÅTRICA)"
    ] %}
    <select name="setor" required>
        <option value="" disabled {% if not funcionario.setor %}selected{% endif %}>Selecione...</option>
        {% for s in opcoes_setor %}
            <option value="{{ s }}" {% if funcionario.setor == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
    </select>

    <label>Telefone</label>
    <input type="text" name="telefone" value="{{ funcionario.telefone }}">

    <label>Email</label>
    <input type="email" name="email" value="{{ funcionario.email }}">

    <label>Status</label>
    <select name="status">
        <option value="Ativo" {% if funcionario.status == "Ativo" %}selected{% endif %}>Ativo</option>
        <option value="Inativo" {% if funcionario.status == "Inativo" %}selected{% endif %}>Inativo</option>
    </select>

    <hr style="margin:18px 0; border:none; border-top:1px solid #eee;">

    <h3 style="margin:0 0 10px 0;">Escala</h3>

    <label>Tipo de escala</label>
    <select name="escala_tipo" required>
        <option value="SEG_SEX" {% if (funcionario.escala_tipo or "SEG_SEX") == "SEG_SEX" %}selected{% endif %}>
            SEG-SEX (08:00‚Äì17:00) + folga S√°b/Dom
        </option>
        <option value="PLANTONISTA_24_96" {% if funcionario.escala_tipo == "PLANTONISTA_24_96" %}selected{% endif %}>
            Plantonista 24x96 (ciclo a cada 5 dias)
        </option>
    </select>

    <label>Base do plant√£o (YYYY-MM-DD)</label>
    <input
        type="date"
        name="plantao_base"
        value="{{ funcionario.plantao_base or '' }}"
        placeholder="YYYY-MM-DD"
    >
    <small style="grid-column: 1 / -1; color:#666; margin-top:-6px;">
        Preencha apenas se o tipo de escala for <b>Plantonista 24x96</b>. √â a data do primeiro plant√£o do ciclo.
    </small>

    <div style="margin-top:20px; display:flex; gap:10px;">

        <button type="submit" class="btn-outline" style="background:#0d6efd; color:white;">
            üíæ Salvar Altera√ß√µes
        </button>

        <a href="/admin/funcionario/{{ funcionario.id }}" class="btn-outline">
            Cancelar
        </a>

    </div>

</form>

</div>

<script>
  // desabilita o campo base quando n√£o for plantonista
  const tipo = document.querySelector('select[name="escala_tipo"]');
  const base = document.querySelector('input[name="plantao_base"]');
  const setor = document.querySelector('select[name="setor"]');

  function toggleBase(){
    const isPlantonista = (tipo.value === "PLANTONISTA_24_96");
    base.disabled = !isPlantonista;
    if (!isPlantonista) base.value = "";
  }

  // opcional: se escolher um setor M√âDICO(...), sugere plantonista automaticamente
  function autoTipoPorSetor(){
    const v = (setor.value || "");
    const isMedico = v.startsWith("M√âDICO(") || v === "DIRETORA M√âDICA";
    if (isMedico) {
      tipo.value = "PLANTONISTA_24_96";
    }
    toggleBase();
  }

  tipo.addEventListener("change", toggleBase);
  setor.addEventListener("change", autoTipoPorSetor);

  toggleBase();
</script>

{% endblock %}
