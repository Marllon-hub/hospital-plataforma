{% extends "base.html" %}
{% block title %}Comunicados - DireÃ§Ã£o{% endblock %}

{% block content %}

<div style="max-width:1100px; margin:0 auto;">

  <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
    <div>
      <h1 style="margin:0 0 6px 0;">ðŸ“¢ Comunicados Internos</h1>
      <p style="margin:0; color:#6c757d;">Publicar avisos com texto formatado e/ou PDF.</p>
    </div>
  </div>

  {% if erro %}
    <div class="card" style="margin-top:14px; border-left:5px solid #dc3545;">
      <b style="color:#dc3545;">{{ erro }}</b>
    </div>
  {% endif %}

  {% if sucesso %}
    <div class="card" style="margin-top:14px; border-left:5px solid #198754;">
      <b style="color:#198754;">{{ sucesso }}</b>
    </div>
  {% endif %}

  <!-- FORM NOVO COMUNICADO -->
  <div class="card" style="margin-top:14px;">
    <h3 style="margin-top:0;">âž• Novo comunicado</h3>

    <form method="POST" enctype="multipart/form-data" style="display:flex; flex-direction:column; gap:12px;">

      <div>
        <label style="font-weight:700;">TÃ­tulo</label><br>
        <input type="text" name="titulo" required
               style="width:100%; padding:10px; border:1px solid #ddd; border-radius:10px;">
      </div>

      <div>
        <label style="font-weight:700;">Texto (com ediÃ§Ã£o)</label>

        <!-- toolbar simples -->
        <div style="display:flex; gap:8px; flex-wrap:wrap; margin:8px 0;">
          <button type="button" class="btn-outline" onclick="cmd('bold')"><b>B</b></button>
          <button type="button" class="btn-outline" onclick="cmd('italic')"><i>I</i></button>
          <button type="button" class="btn-outline" onclick="cmd('underline')"><u>U</u></button>
          <button type="button" class="btn-outline" onclick="cmd('insertUnorderedList')">â€¢ Lista</button>
          <button type="button" class="btn-outline" onclick="cmd('insertOrderedList')">1. Lista</button>
          <button type="button" class="btn-outline" onclick="addLink()">ðŸ”— Link</button>
          <button type="button" class="btn-outline" onclick="cmd('removeFormat')">ðŸ§¹ Limpar</button>
        </div>

        <!-- editor -->
        <div id="editor"
             contenteditable="true"
             style="min-height:180px; border:1px solid #ddd; border-radius:12px; padding:12px; background:#fff;">
        </div>

        <!-- campo escondido que vai para o backend -->
        <input type="hidden" name="conteudo_html" id="conteudo_html">
        <small style="color:#6c757d;">VocÃª pode publicar sÃ³ o texto, sÃ³ o PDF, ou os dois.</small>
      </div>

      <div>
        <label style="font-weight:700;">Anexar PDF (opcional)</label><br>
        <input type="file" name="pdf" accept="application/pdf">
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button type="submit" class="btn" style="background:#198754;" onclick="beforeSubmit()">
          ðŸ“¢ Publicar
        </button>
      </div>

    </form>
  </div>

  <!-- LISTA DE COMUNICADOS -->
  <div class="card" style="margin-top:14px;">
    <h3 style="margin-top:0;">ðŸ“Œ Comunicados publicados</h3>

    {% if comunicados %}
      <div style="display:flex; flex-direction:column; gap:12px;">
        {% for c in comunicados %}
          <div style="border:1px solid #eee; border-radius:12px; padding:14px;">
            <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
              <div>
                <div style="font-weight:800; font-size:16px;">{{ c.titulo }}</div>
                <div style="color:#6c757d; font-size:12px;">{{ c.data }}</div>
              </div>

              {% if c.pdf %}
                <a class="btn-outline" target="_blank"
                   href="{{ url_for('static', filename='uploads/comunicados/' ~ c.pdf) }}">
                  ðŸ“„ PDF
                </a>
              {% endif %}
            </div>

            {% if c.conteudo_html %}
              <div style="margin-top:10px; color:#333;">
                {{ c.conteudo_html|safe }}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color:#6c757d; margin:0;">Nenhum comunicado cadastrado.</p>
    {% endif %}
  </div>

</div>

<script>
  function cmd(command){
    document.execCommand(command, false, null);
  }

  function addLink(){
    const url = prompt("Cole o link (https://...)");
    if (!url) return;
    document.execCommand("createLink", false, url);
  }

  function beforeSubmit(){
    const html = document.getElementById("editor").innerHTML.trim();
    document.getElementById("conteudo_html").value = html;
  }
</script>

{% endblock %}
